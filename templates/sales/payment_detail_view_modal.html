<div class="modal-content roboto-condensed-regular">
    <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="paymentDetailModalLabel">
            <i class="fas fa-money-bill-wave mr-2"></i>
            Detalles de Pagos - Orden {{ order.correlative }}
        </h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    
    <div class="modal-body">
        <!-- Información del Cliente -->
        <div class="card mb-3">
            <div class="card-body">
                <h6 class="card-title">
                    <i class="fas fa-user mr-2"></i>
                    Cliente: {{ client.names }}
                </h6>
            </div>
        </div>

        <!-- Lista de Pagos -->
        {% if payments_list %}
            {% for payment in payments_list %}
            <div class="card mb-3">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-info-circle mr-2"></i>
                        Pago #{{ forloop.counter }} - {{ payment.date|date:"d/m/Y" }}
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <p><strong>Fecha de Pago:</strong></p>
                            <h5>{{ payment.date|date:"d/m/Y" }}</h5>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Monto Total:</strong></p>
                            <h4 class="text-success">S/ {{ payment.amount|floatformat:2 }}</h4>
                        </div>
                    </div>

                    {% if payment.observation %}
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <p><strong>Observaciones:</strong></p>
                            <p class="text-muted">{{ payment.observation }}</p>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Detalles de Transacciones -->
                    {% if payment.transaction_payments %}
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <p><strong>Detalles de Transacciones:</strong></p>
                            <table class="table table-sm table-bordered">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Tipo de Pago</th>
                                        <th>Monto</th>
                                        <th>Código de Operación</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for tp in payment.transaction_payments %}
                                    <tr>
                                        <td><span class="badge badge-secondary">{{ tp.get_type_display }}</span></td>
                                        <td class="text-right font-weight-bold">S/ {{ tp.payment|floatformat:2 }}</td>
                                        <td>{{ tp.operation_code|default:"-" }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Comprobante -->
                    {% if payment.file_url %}
                    <div class="row">
                        <div class="col-md-12">
                            <p><strong>Comprobante de Pago:</strong></p>
                            <button type="button" class="btn btn-info"
                                    onclick="loadFile('{{ payment.file_url }}', '{{ payment.loan_payment.id }}')"
                                    data-toggle="modal"
                                    data-target="#fileModal">
                                <i class="fas fa-file-image mr-1"></i>
                                Ver Comprobante
                            </button>
                        </div>
                    </div>
                    {% else %}
                    <div class="row">
                        <div class="col-md-12">
                            <p class="text-muted"><i class="fas fa-info-circle mr-1"></i> No hay comprobante disponible para este pago.</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                No hay pagos registrados para esta orden.
            </div>
        {% endif %}
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
            <i class="fas fa-times mr-1"></i>
            Cerrar
        </button>
    </div>
</div>

