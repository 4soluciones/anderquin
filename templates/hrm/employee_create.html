<div class="modal-dialog modal-dialog-centered modal-lg roboto-condensed-regular" role="document">
    <div class="modal-content border-0 shadow-lg" style="border-radius: 16px; overflow: hidden;">
        <div class="modal-header border-0 py-4" style="background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);">
            <h5 class="modal-title text-white text-uppercase roboto-condensed-regular">
                <i class="fas fa-user-plus mr-2"></i>Registro del trabajador
            </h5>
            <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>

        <form class="was-validated" id="employee-create-form" action="{% url 'hrm:json_employee_create' %}" method="POST">
            {% csrf_token %}
            <div class="modal-body p-0">
                <ul class="nav nav-tabs px-4 pt-3 border-0" id="tabEmployeeCreate" role="tablist" style="background: #f0f8fc; border-bottom: 2px solid #bbdefb;">
                    <li class="nav-item">
                        <a class="nav-link active rounded-top border-0 py-2 px-3" id="tab-one-create" data-toggle="tab" href="#content-one-create" role="tab" style="color: #0d47a1;">
                            <i class="fas fa-id-card mr-1"></i>Datos personales
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link rounded-top border-0 py-2 px-3" id="tab-two-create" data-toggle="tab" href="#content-two-create" role="tab" style="color: #0d47a1;">
                            <i class="fas fa-map-marker-alt mr-1"></i>Dirección 1
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link rounded-top border-0 py-2 px-3" id="tab-three-create" data-toggle="tab" href="#content-three-create" role="tab" style="color: #0d47a1;">
                            <i class="fas fa-map-marker-alt mr-1"></i>Dirección 2
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link rounded-top border-0 py-2 px-3" id="tab-four-create" data-toggle="tab" href="#content-four-create" role="tab" style="color: #0d47a1;">
                            <i class="fas fa-plus-circle mr-1"></i>Datos adicionales
                        </a>
                    </li>
                </ul>
                <div class="tab-content p-4" id="tabContentEmployeeCreate" style="background: #fff;">
                    <div class="tab-pane fade show active" id="content-one-create" role="tabpanel">
                        <div class="form-row">
                            <div class="col-md-8 mb-3">
                                <label class="text-dark">{{ form.document_type.label }}</label>
                                {{ form.document_type }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="text-dark">{{ form.document_number.label }}</label>
                                {{ form.document_number }}
                                {% for error in form.document_number.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
                            </div>
                            <div class="col-md-8 mb-3">
                                <label class="text-dark">{{ form.document_issuing_country.label }}</label>
                                {{ form.document_issuing_country }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="text-dark">{{ form.birthdate.label }}</label>
                                {{ form.birthdate }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="text-dark">{{ form.paternal_last_name.label }}</label>
                                {{ form.paternal_last_name }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="text-dark">{{ form.maternal_last_name.label }}</label>
                                {{ form.maternal_last_name }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="text-dark">{{ form.names.label }}</label>
                                {{ form.names }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="text-dark">{{ form.gender.label }}</label>
                                {{ form.gender }}
                            </div>
                            <div class="col-md-8 mb-3">
                                <label class="text-dark">{{ form.nationality.label }}</label>
                                {{ form.nationality }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="text-dark">{{ form.telephone_national_long_distance_code.label }}</label>
                                {{ form.telephone_national_long_distance_code }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="text-dark">{{ form.telephone_number.label }}</label>
                                {{ form.telephone_number }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="text-dark">{{ form.email.label }}</label>
                                {{ form.email }}
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="content-two-create" role="tabpanel">
                        <div class="form-row">
                            <div class="col-md-6 mb-3"><label class="text-dark">{{ form.address_1_road_type.label }}</label>{{ form.address_1_road_type }}</div>
                            <div class="col-md-4 mb-3"><label class="text-dark">{{ form.address_1_road_name.label }}</label>{{ form.address_1_road_name }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_1_road_number.label }}</label>{{ form.address_1_road_number }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_1_department.label }}</label>{{ form.address_1_department }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_1_interior.label }}</label>{{ form.address_1_interior }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_1_apple.label }}</label>{{ form.address_1_apple }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_1_lot.label }}</label>{{ form.address_1_lot }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_1_kilometer.label }}</label>{{ form.address_1_kilometer }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_1_block.label }}</label>{{ form.address_1_block }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_1_stage.label }}</label>{{ form.address_1_stage }}</div>
                            <div class="col-md-4 mb-3"><label class="text-dark">{{ form.address_1_zone_type.label }}</label>{{ form.address_1_zone_type }}</div>
                            <div class="col-md-6 mb-3"><label class="text-dark">{{ form.address_1_zone_name.label }}</label>{{ form.address_1_zone_name }}</div>
                            <div class="col-md-6 mb-3"><label class="text-dark">{{ form.address_1_reference.label }}</label>{{ form.address_1_reference }}</div>
                            <div class="col-md-6 mb-3"><label class="text-dark">{{ form.address_1_district.label }}</label>{{ form.address_1_district }}</div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="content-three-create" role="tabpanel">
                        <div class="form-row">
                            <div class="col-md-6 mb-3"><label class="text-dark">{{ form.address_2_road_type.label }}</label>{{ form.address_2_road_type }}</div>
                            <div class="col-md-4 mb-3"><label class="text-dark">{{ form.address_2_road_name.label }}</label>{{ form.address_2_road_name }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_2_road_number.label }}</label>{{ form.address_2_road_number }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_2_department.label }}</label>{{ form.address_2_department }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_2_interior.label }}</label>{{ form.address_2_interior }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_2_apple.label }}</label>{{ form.address_2_apple }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_2_lot.label }}</label>{{ form.address_2_lot }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_2_kilometer.label }}</label>{{ form.address_2_kilometer }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_2_block.label }}</label>{{ form.address_2_block }}</div>
                            <div class="col-md-2 mb-3"><label class="text-dark">{{ form.address_2_stage.label }}</label>{{ form.address_2_stage }}</div>
                            <div class="col-md-4 mb-3"><label class="text-dark">{{ form.address_2_zone_type.label }}</label>{{ form.address_2_zone_type }}</div>
                            <div class="col-md-6 mb-3"><label class="text-dark">{{ form.address_2_zone_name.label }}</label>{{ form.address_2_zone_name }}</div>
                            <div class="col-md-6 mb-3"><label class="text-dark">{{ form.address_2_reference.label }}</label>{{ form.address_2_reference }}</div>
                            <div class="col-md-6 mb-3"><label class="text-dark">{{ form.address_2_district.label }}</label>{{ form.address_2_district }}</div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="content-four-create" role="tabpanel">
                        <div class="form-group"><label class="text-dark">{{ form.essalud_assistance.label }}</label>{{ form.essalud_assistance }}</div>
                        <div class="form-group"><label class="text-dark">{{ form.n_license.label }}</label>{{ form.n_license }}</div>
                        <div class="form-group"><label class="text-dark">{{ form.license_type.label }}</label>{{ form.license_type }}</div>
                        <div class="form-group mb-0"><label class="text-dark">{{ form.license_expiration_date.label }}</label>{{ form.license_expiration_date }}</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 bg-light py-3 px-4">
                <button type="button" class="btn btn-outline-secondary px-4" data-dismiss="modal" style="border-radius: 10px;">Cerrar</button>
                <button id="btn-employee-create-submit" type="submit" class="btn btn-primary px-4" style="border-radius: 10px; background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);">
                    <i class="fas fa-save mr-1"></i> Guardar
                </button>
            </div>
        </form>
    </div>
</div>

<style>
    #employee-create-form .form-control, #employee-create-form .custom-select { border-radius: 10px; border-color: #bbdefb; }
    #employee-create-form .form-control:focus { border-color: #1565c0; box-shadow: 0 0 0 0.2rem rgba(21, 101, 192, 0.25); }
    #tabEmployeeCreate .nav-link { font-weight: 500; }
    #tabEmployeeCreate .nav-link:hover { background: #e3f2fd; color: #0d47a1 !important; }
    #tabEmployeeCreate .nav-link.active { background: #fff !important; color: #1565c0 !important; border-bottom: 2px solid #fff !important; margin-bottom: -2px; }
</style>

<script type="text/javascript">
$(document).ready(function() {
    $('#id_document_type option[value=01]').attr('selected','selected');
    $('#id_document_issuing_country option[value=604]').attr('selected','selected');
    $('#id_nationality option[value=9589]').attr('selected','selected');
    $('#id_telephone_national_long_distance_code option[value=54]').attr('selected','selected');
    $('#id_document_type').select2({ theme: 'bootstrap4' });
    $('#id_document_issuing_country').select2({ theme: 'bootstrap4' });
    $('#id_nationality').select2({ theme: 'bootstrap4' });
    $('#id_address_1_district').select2({ theme: 'bootstrap4' });
    $('#id_address_2_district').select2({ theme: 'bootstrap4' });
});

$("#employee-create-form").submit(function (event) {
    event.preventDefault();
    var data = new FormData($('#employee-create-form').get(0));
    $("#btn-employee-create-submit").prop("disabled", true);
    $.ajax({
        url: "/hrm/json_employee_create/",
        type: "POST",
        data: data,
        cache: false,
        processData: false,
        contentType: false,
        success: function (response, textStatus, xhr) {
            if(xhr.status==200){
                toastr.success('Guardado con éxito.','¡Bien hecho!');
                $.ajax({
                    url: '{% url 'hrm:json_employee_list' %}',
                    async: true,
                    dataType: 'json',
                    type: 'GET',
                    success: function (response) {
                        $("#employee-grid-list").html(response.result);
                        refreshTable();
                    },
                    fail: function () { toastr.error("Error.", '¡Error!'); }
                });
                $('#creation').modal('hide');
            }
            $("#btn-employee-create-submit").prop("disabled", false);
        },
        error: function(jqXhr) {
            if(jqXhr.status==500 && jqXhr.responseJSON && jqXhr.responseJSON.form_invalid){
                toastr.error(jqXhr.responseJSON.form_invalid.name || jqXhr.responseJSON.error, '¡Error!');
            }
            $("#btn-employee-create-submit").prop("disabled", false);
            $('#creation').modal('hide');
        }
    });
});
</script>
