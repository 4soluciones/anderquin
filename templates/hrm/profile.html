{% extends 'home.html' %}
{% load static %}

{% block title %}Perfil{% endblock title %}

{% block body %}
<div class="container-fluid py-4 roboto-condensed-regular" style="background: linear-gradient(180deg, #e8f4f8 0%, #e3f2fd 100%); min-height: 100vh;">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10 col-xl-8">
            <div class="card border-0 shadow-lg overflow-hidden" style="border-radius: 20px;">
                <!-- Header con gradiente -->
                <div class="card-header border-0 py-5 text-white text-center" style="background: linear-gradient(135deg, #1565c0 0%, #0d47a1 50%, #0a3d91 100%);">
                    <div class="mb-3">
                        <span class="d-inline-flex align-items-center justify-content-center rounded-circle bg-white bg-opacity-25 p-4">
                            <i class="fas fa-user fa-3x"></i>
                        </span>
                    </div>
                    <h4 class="font-weight-bold mb-1 text-white">
                        {% if employee %}
                            {{ employee.names|default:"" }} {{ employee.paternal_last_name|default:"" }} {{ employee.maternal_last_name|default:"" }}
                        {% else %}
                            {{ user.get_full_name|default:user.username }}
                        {% endif %}
                    </h4>
                    <p class="mb-0 opacity-90">
                        {% if worker and worker.user %}
                            <i class="fas fa-at mr-1"></i>{{ worker.user.username }}
                        {% else %}
                            <i class="fas fa-at mr-1"></i>{{ user.username }}
                        {% endif %}
                    </p>
                </div>

                <div class="card-body p-4 p-md-5">
                    {% if employee %}
                    <!-- Datos personales -->
                    <section class="mb-5">
                        <h5 class="text-primary font-weight-bold mb-4 pb-2 border-bottom" style="border-color: #bbdefb !important;">
                            <i class="fas fa-id-card mr-2"></i>Datos personales
                        </h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <span class="text-muted small d-block">Documento</span>
                                <strong>{{ employee.document_type.short_description|default:employee.document_type.description|default:"-" }}</strong> {{ employee.document_number|default:"-" }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <span class="text-muted small d-block">Nacionalidad</span>
                                <strong>{{ employee.document_issuing_country.description|default:"-" }}</strong>
                            </div>
                            <div class="col-md-6 mb-3">
                                <span class="text-muted small d-block">Correo</span>
                                <strong>{{ employee.email|default:"-" }}</strong>
                            </div>
                            <div class="col-md-6 mb-3">
                                <span class="text-muted small d-block">Teléfono</span>
                                <strong>{{ employee.telephone_number|default:"-" }}</strong>
                            </div>
                        </div>
                    </section>

                    {% if worker %}
                    <!-- Datos laborales y enlaces -->
                    <section class="mb-5">
                        <h5 class="text-primary font-weight-bold mb-4 pb-2 border-bottom" style="border-color: #bbdefb !important;">
                            <i class="fas fa-briefcase mr-2"></i>Datos laborales
                        </h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <span class="text-muted small d-block">Ocupación</span>
                                <strong>
                                    {% if worker.occupation_private_sector %}
                                        {{ worker.occupation_private_sector.name|default:"-" }}
                                    {% elif worker.occupation_public_sector %}
                                        {{ worker.occupation_public_sector.name|default:"-" }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </strong>
                            </div>
                            <div class="col-md-6 mb-3">
                                <span class="text-muted small d-block">Tipo de trabajador</span>
                                <strong>{% with wt=worker.get_worker_type %}{{ wt.description|default:"-" }}{% endwith %}</strong>
                            </div>
                            <div class="col-md-6 mb-3">
                                <span class="text-muted small d-block">Régimen salud</span>
                                <strong>{% with hr=worker.get_health_insurance_regime %}{{ hr.description|default:"-" }}{% endwith %}</strong>
                            </div>
                            <div class="col-md-6 mb-3">
                                <span class="text-muted small d-block">Régimen pensionario</span>
                                <strong>{% with pr=worker.get_pensioner_regime %}{{ pr.description|default:"-" }}{% endwith %}</strong>
                            </div>
                        </div>
                    </section>

                    <!-- Enlaces a módulos relacionados -->
                    <section class="mb-4">
                        <h5 class="text-primary font-weight-bold mb-4 pb-2 border-bottom" style="border-color: #bbdefb !important;">
                            <i class="fas fa-link mr-2"></i>Accesos rápidos
                        </h5>
                        <div class="row">
                            <div class="col-6 col-md-4 mb-3">
                                <a href="{% url 'hrm:employee_list' %}" class="btn btn-outline-primary btn-block py-3 rounded-lg shadow-sm">
                                    <i class="fas fa-users d-block mb-2 fa-2x"></i>
                                    <span class="small">Trabajadores</span>
                                </a>
                            </div>
                            <div class="col-6 col-md-4 mb-3">
                                <a href="{% url 'hrm:get_subsidiary' %}" class="btn btn-outline-primary btn-block py-3 rounded-lg shadow-sm">
                                    <i class="fas fa-building d-block mb-2 fa-2x"></i>
                                    <span class="small">Sedes</span>
                                </a>
                            </div>
                            <div class="col-6 col-md-4 mb-3">
                                <a href="{% url 'hrm:settings_password' %}" class="btn btn-outline-primary btn-block py-3 rounded-lg shadow-sm">
                                    <i class="fas fa-key d-block mb-2 fa-2x"></i>
                                    <span class="small">Cambiar contraseña</span>
                                </a>
                            </div>
                        </div>
                    </section>

                    <!-- Sede actual -->
                    {% for e in worker.establishment_set.all %}
                        {% if forloop.first %}
                        <div class="alert alert-light border rounded-lg mb-0" style="border-color: #bbdefb !important;">
                            <strong><i class="fas fa-map-marker-alt text-primary mr-2"></i>Sede actual:</strong>
                            {{ e.subsidiary.name|default:"-" }}
                            {% if e.subsidiary.address %}
                                <br><span class="text-muted small">{{ e.subsidiary.address }}</span>
                            {% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                    {% endif %}
                    {% else %}
                    <div class="text-center py-4">
                        <p class="text-muted">No hay perfil de empleado asociado a este usuario.</p>
                        <a href="{% url 'hrm:settings_password' %}" class="btn btn-primary rounded-lg">
                            <i class="fas fa-key mr-2"></i>Cambiar contraseña
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock body %}
