{% if employees %}

<div class="table-responsive rounded" style="background: #fff; border-radius: 12px; border: 1px solid #bbdefb;">
    <table id="employee-data-grid" class="table table-hover table-bordered mb-0" cellspacing="0" width="100%" style="border-color: #bbdefb;">
        <thead>
            <tr class="text-center text-uppercase">
                <th style="width: 2rem;">#</th>
                <th class="th-sm">Trabajador</th>
                <th class="th-sm">Documento</th>
                <th class="th-sm">Sede</th>
                <th class="th-sm th-usuario">Usuario</th>
                <th class="th-sm">Ocupación</th>
                <th class="th-sm">Tipo trab.</th>
                <th class="th-sm text-nowrap" style="width: 10rem;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for employee in employees %}
            <tr class="text-center align-middle">
                <td></td>
                <td class="text-left text-uppercase">
                    <strong>{{ employee.names|default:"-" }} {{ employee.paternal_last_name|default:"" }} {{ employee.maternal_last_name|default:"" }}</strong>
                </td>
                <td>
                    <span class="text-muted small">{{ employee.document_type.short_description|default:employee.document_type.description|default:"-" }}</span>
                    <br><strong>{{ employee.document_number|default:"-" }}</strong>
                </td>
                <td>
                    {% for w in employee.worker_set.all %}
                        {% if forloop.first %}
                            {% for e in w.establishment_set.all %}
                                {% if forloop.first %}
                                    {{ e.subsidiary.name|default:"-" }}
                                {% endif %}
                            {% empty %}-{% endfor %}
                        {% endif %}
                    {% empty %}-{% endfor %}
                </td>
                <td class="td-usuario">
                    {% for w in employee.worker_set.all %}
                        {% if forloop.first %}
                            {{ w.user.username|default:"-" }}
                        {% endif %}
                    {% empty %}-{% endfor %}
                </td>
                <td class="text-left small">
                    {% for w in employee.worker_set.all %}
                        {% if forloop.first %}
                            {% if w.occupation_private_sector %}
                                {{ w.occupation_private_sector.name|default:"-" }}
                            {% elif w.occupation_public_sector %}
                                {{ w.occupation_public_sector.name|default:"-" }}
                            {% else %}
                                -
                            {% endif %}
                        {% endif %}
                    {% empty %}-{% endfor %}
                </td>
                <td class="small">
                    {% for w in employee.worker_set.all %}
                        {% if forloop.first %}
                            {% with wt=w.get_worker_type %}
                                {{ wt.description|default:"-" }}
                            {% endwith %}
                        {% endif %}
                    {% empty %}-{% endfor %}
                </td>
                <td>
                    <div class="btn-group dropleft">
                        <button type="button" class="btn btn-sm btn-outline-primary dropdown-toggle py-1 px-2" data-toggle="dropdown" data-boundary="viewport" aria-haspopup="true" aria-expanded="false" style="border-radius: 8px;">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-right shadow border-0" style="border-radius: 10px;">
                            <a class="dropdown-item py-2" href="#" onclick="showModalEdition('{% url 'hrm:json_employee_edit' employee.id %}'); return false;">
                                <i class="fas fa-edit text-info mr-2"></i> Editar
                            </a>
                            {% for w in employee.worker_set.all %}
                                {% if forloop.first %}
                                    <a class="dropdown-item py-2 worker-change-designation" href="#" pk="{{ w.id }}">
                                        <i class="fas fa-sync-alt text-primary mr-2"></i> Modificar datos del trabajador
                                    </a>
                                    <a class="dropdown-item py-2 worker-change-establishment" href="#" pk="{{ w.id }}">
                                        <i class="fas fa-building text-primary mr-2"></i> Modificar sede
                                    </a>
                                    <a class="dropdown-item py-2 worker-change-user" href="#" pk="{{ w.id }}">
                                        <i class="fas fa-user-cog text-primary mr-2"></i> Modificar usuario
                                    </a>
                                {% endif %}
                            {% endfor %}
                            {% if not employee.worker_set.all %}
                                <a class="dropdown-item py-2 worker-designation" href="#" pk="{{ employee.id }}">
                                    <i class="fas fa-user-tag text-primary mr-2"></i> Crear Datos del trabajador
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<div class="card border-0 shadow-sm text-center py-5" style="background: #fff; border-radius: 12px;">
    <i class="fas fa-users fa-3x text-muted mb-3"></i>
    <h5 class="text-muted">No hay trabajadores registrados</h5>
    <p class="text-muted small mb-0">Use el botón "Nuevo trabajador" para agregar el primero.</p>
</div>
{% endif %}
